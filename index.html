<!DOCTYPE html>
<html ng-app="Xmpp">
<head>
<meta charset="utf-8"/>
<script src="scripts/primus.js" type="text/javascript"></script>
<script data-require="angular.js@*" data-semver="1.3.7" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.7/angular.js"></script>
<script data-require="underscore.js@*" data-semver="1.6.0" src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/angular-strap/2.1.2/angular-strap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/angular-strap/2.1.2/angular-strap.tpl.min.js"></script>
<script src="//code.angularjs.org/1.3.8/angular-animate.min.js" data-semver="1.3.8"></script>
<script src="//code.angularjs.org/1.3.8/angular-sanitize.min.js" data-semver="1.3.8"></script>

<link rel="stylesheet" href="css/style.css">
<script src="js/script.js"></script>
</head>
<body ng-controller="Roster">


<h2>Buddycloud</h2>
<form class="loginform" ng-show="!connected" ng-submit="login()">
<table>
<tr><td>username</td><td><input ng-model="username"/></td></tr>
<tr><td>password</td><td><input type="password" ng-model="password"/></td></tr>
<tr><td>register</td><td><input type="checkbox" ng-model="register"/></td></tr>
<tr><td></td><td><input ng-if="connection_open" type="submit" value="login"/></td></tr>
</table>
(u1 - u9 have avatar images)
</form>
<div ng-show="connected"  id="buddycloud" >
<form ng-submit="publish()">
<input ng-model="newtopic" placeholder="What's going on" >
</form>


<div  ng-repeat="item in tree | orderBy:'-entry.atom.published'" class="item">
<img  ng-src="icons/avatars/{{item.entry.atom.author.image}}.png" />
<div class="person">
<span class="name">{{item.entry.atom.author.name}}</span>
<span class="date">{{item.entry.atom.published | date:'medium'}}</span>
<span class="date">{{item.entry.atom.published}}</span>

</div>
    <span class="delete" ng-click="removeitem(item.entry.atom.id)">×</span>
<div class="content">
{{item.entry.atom.content.content}}
</div>
<span class="like">like . share</span>
<br/>
<div ng-repeat="subitem in item.nodes" class="subitem">
    <img  ng-src="icons/avatars/{{item.entry.atom.author.image}}.png" />
    <div class="person">
    <span class="name">{{item.entry.atom.author.name}}</span>
    {{subitem.entry.atom.content.content}}

    <span class="date">{{item.entry.atom.published | date:'medium'}}</span>
    <span class="delete" ng-click="removeitem(subitem.entry.atom.id)">×</span>
    </div>
</div>
<form ng-submit="publish(item.entry.atom.id)">
<img  ng-src="icons/avatars/{{username}}.png" style="height:30px;margin-top:0px;"/>
<input ng-model="newitems[item.entry.atom.id]" />
</form>
</div>
</div>



<div class="roster" ng-show="connected">
<table >
<tr ng-if="user.presence" ng-repeat="user in roster" ng-click="open(user)"><td>
<img ng-src="icons/avatars/{{user.name}}.png" style="height:40px"/>
</td>
<td>
<p>{{user.name}}</p>
{{user.presence.status}}
</td></tr></table>
<h4>Add JID</h4>
<form ng-submit="addjid()">
<input ng-model="newjid"/>
</form>
<h4>Friend requests</h4>
<table >
<tr ng-if="user.subscription=='from'" ng-repeat="user in roster" ng-click="allow(user)"><td>
<img ng-src="icons/avatars/{{user.name}}.png" style="height:40px"/>
</td>
<td>
<p>{{user.name}}</p>
{{user.presence.status}}
</td></tr></table>
</div>


<div id="bottomchat" >
  <div class="minichat" ng-if="user.opened" ng-repeat="user in roster" title="{{ user.name }}"  >
    <div ng-if="user.opened=='max'">
        <div class="title" ng-click="minify(user)"><p>{{user.name}}</p><span class="close" ng-click="close(user)">×</span></div>
            <div class="messages">
                <div ng-repeat="message in user.messages">
                <img ng-if="message.from" ng-src="icons/avatars/{{message.from.user}}.png" />
                <img ng-if="!message.from" ng-src="icons/avatars/{{username}}.png" />
                {{message.content}}
                </div>
            <div id="bottom_{{user.name}}"> </div>
            </div>

        <form ng-submit="send(user)">
        <input ng-model="user.newtext"/>
        </form>
      </div>
    <div ng-if="user.opened=='min'" ng-click="open(user)" class="min">
    {{user.name}}<span class="close" ng-click="close(user)">×</span>
    </div>
    </div>
</div>

</body>

</html>
