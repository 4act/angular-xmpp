

<div ng-show="connected " class="buddycloud">
    <br/>
    <br/>

    <div ng-if="node!='recent'">
        <button ng-if="!data.subscribed" ng-click="subscribe()" class="btn btn-default">subscribe</button>
        <button ng-if="data.subscribed" ng-click="unsubscribe()" class="btn btn-default">unsubscribe</button>
        <button ng-click="getConfig()" class="btn btn-default">
            <span class="glyphicon glyphicon-cog"></span>
        </button>
        <button ng-click="addFriend(node)" class="pull-right btn btn-default">add Friend</button>
        <button ng-click="removeFriend(node)" class="pull-right btn btn-default">remove Friend</button>
        <br/>
    </div>
    <br/>


    <div class="form" ng-show="formdata" style="position:relative;height:1300px">
            <xmppform formdata="formdata" onclose="formdata=null" onsave="setConfig"></xmppform>
    </div>



    <div ng-show="!formdata">

    <form ng-submit="publish()">
        <textarea ng-model="newtopic" placeholder="What's going on"></textarea>
        <input ng-show="newtopic" type="submit" />
    </form>

    <div ng-if="!data.tree">loading...</div>

    <div ng-repeat="item in data.tree |toArray|orderBy:'-entry.atom.published' " class="item">
        <span class="tool pull-right" ng-click="removeitem(item.entry.atom.id,item.node)">×</span>
        <span class="tool pull-right" ng-click="edititem(editmode=!editmode)">✎</span>
        <img ng-src="icons/avatars/{{item.entry.atom.author.image}}.png" />
        <div class="person">
            <span class="name">
<span ng-click="opennode(item.entry.atom.author.name)">{{item.entry.atom.author.name}}</span>
            <span ng-click="opennode(item.nodeowner)" ng-show="item.entry.atom.author.name!=item.nodeowner && node=='recent'"> → {{item.nodeowner}}</span>
            </span>
            <span class="date">{{item.entry.atom.published | date:'medium'}}</span>
            <like node="{{item.id}}"></like>


        </div>
        <div class="content">
            <form ng-show="editmode && data.subscribed" ng-submit="save()">
                <textarea ng-model="item.entry.atom.content.content"></textarea>
                <input type="submit" />
            </form>
            <div ng-show="!editmode" btf-markdown="item.entry.atom.content.content"></div>

        </div>
        <br/>
        <div ng-repeat="subitem in item.nodes|toArray|orderBy:'entry.atom.published'" class="subitem">

            <span class="tool pull-right" ng-click="removeitem(subitem.entry.atom.id,subitem.node)">×</span>
            <span class="tool pull-right" ng-click="edititem(editmode=!editmode)">✎</span>
            <img ng-src="icons/avatars/{{subitem.entry.atom.author.image}}.png" />
            <div class="person">
                <span class="name" ng-click="opennode(subitem.entry.atom.author.name)">{{subitem.entry.atom.author.name}}</span>
                <input ng-show="editmode" ng-model="subitem.entry.atom.content.content" />
                <span ng-show="!editmode">{{subitem.entry.atom.content.content}}</span>

                <span class="date">{{subitem.entry.atom.published | date:'medium'}}</span>
                <like node="{{subitem.id}}"></like>
            </div>
        </div>
        <form ng-if="data.subscribed" ng-submit="publish(item.entry.atom.id)" class="subitem">
            <img ng-src="icons/avatars/{{jid.local}}.png" />
            <div class="person">
                <input ng-model="newitems[item.entry.atom.id]" />
            </div>
        </form>
    </div>
    </div>
</div>

