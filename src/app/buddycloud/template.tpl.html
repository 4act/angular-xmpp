

<div ng-show="connected " class="buddycloud" tagged-infinite-scroll="getMore()" tagged-infinite-scroll-disabled="fetching || disabled" tagged-infinite-scroll-distance="500">

    <div g-show="!formdata">
    <div class="streamheader">
    <div ng-if="node!='recent'">
        <button ng-if="!data.rights.subscribed" ng-click="subscribe()" class="btn btn-link">subscribe</button>
        <button ng-if="data.rights.subscribed" ng-click="unsubscribe()" class="btn btn-link">unsubscribe</button>
        <button ng-if="data.rights.config" ng-click="getConfig()" class="btn btn-link">
            <span class="glyphicon glyphicon-cog"></span>
        </button>
        <button ng-if="isContact(node)" ng-click="addFriend(node)" class="pull-right btn btn-link">add Contact</button>
        <button ng-if="!isContact(node)" ng-click="removeFriend(node)" class="pull-right btn btn-link">remove Contact</button>
        <br/>
    </div>


    <div class="form" ng-show="formdata" style="position:relative;height:1300px">
            <xmppform formdata="formdata" onclose="formdata=null" onsave="setConfig"></xmppform>
    </div>

    <form ng-show="data.rights.publish || data.currentnode=='recent'" ng-submit="publish()">
        <textarea ng-model="newtopic" placeholder="What's going on"></textarea>
        <input ng-show="newtopic" type="submit" />
    </form>
    </div>

    <div ng-if="!data.tree">loading...</div>
<!--
    <div ng-repeat="item in data.tree |toArray|orderBy:'-entry.atom.published' " class="item">
-->
    <div ng-repeat="item in data.tree |toArray|orderBy:'entry.atom.published':true " class="item">
        {{entry.atom.published}}
        <span ng-if="item.rights.remove" class="tool pull-right" ng-click="removeitem(item.entry.atom.id,item.node)">×</span>
        <span ng-if="item.rights.update" class="tool pull-right" ng-click="edititem(editmode=!editmode)">✎</span>
        <img ng-src="assets/icons/avatars/{{item.entry.atom.author.image}}.png" />
        <div class="person">
            <span class="name">
<span ng-click="opennode(item.entry.atom.author.name)">{{item.entry.atom.author.name}}</span>
            <span ng-click="opennode(item.nodeowner)" ng-show="item.entry.atom.author.name!=item.nodeowner && node=='recent'"> → {{item.nodeowner}}</span>
            </span>
            <span class="date">{{item.entry.atom.published | date:'medium'}}</span>
            <like node="{{item.id}}"></like>


        </div>
        <div class="content">
            <form ng-show="editmode && data.rights.subscribed" ng-submit="save()">
                <textarea ng-model="item.entry.atom.content.content"></textarea>
                <input type="submit" />
            </form>
            <div ng-show="!editmode" btf-markdown="item.entry.atom.content.content"></div>

        </div>
        <br/> 
        <div ng-repeat="subitem in item.nodes  |toArray|orderBy:'entry.atom.published'" class="subitem">
            <span ng-if="subitem.rights.remove" class="tool pull-right" ng-click="removeitem(subitem.entry.atom.id,subitem.node)">×</span>
            <span ng-if="subitem.rights.update" class="tool pull-right" ng-click="edititem(editmode=!editmode)">✎</span>
            <img ng-src="assets/icons/avatars/{{subitem.entry.atom.author.image}}.png" />
            <div class="person">
                <span class="name" ng-click="opennode(subitem.entry.atom.author.name)">{{subitem.entry.atom.author.name}}</span>
                <input ng-show="editmode" ng-model="subitem.entry.atom.content.content" />
                <span ng-show="!editmode">{{subitem.entry.atom.content.content}}</span>

                <span class="date">{{subitem.entry.atom.published | date:'medium'}}</span>
                <like node="{{subitem.id}}"></like>
            </div>
        </div>
        <form ng-if="item.rights.publish" ng-submit="publish(item.entry.atom.id)" class="subitem">
            <img ng-src="assets/icons/avatars/{{jid.local}}.png" />
            <div class="person">
                <input ng-model="newitems[item.entry.atom.id]" />
            </div>
        </form>
    </div>
    </div>
</div>

