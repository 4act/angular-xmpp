<!DOCTYPE html>
<html ng-app="MyApp">
<head>
<meta charset="utf-8"/>
<script type="text/javascript" src="assets/scripts/primus.js"></script>
<!-- compiled CSS -->
<link rel="stylesheet" type="text/css" href="assets/angular-xmpp-0.0.2.css" />
<!-- compiled JavaScript -->
<script type="text/javascript" src="assets/angular-xmpp-0.0.2.js"></script>

<script>
var SCOPE=null;
function page($scope,$rootScope,$location){
    console.log("ääääääääää");
    SCOPE=$scope;
    $scope.node="recent";
    $scope.openchat=function(node){
        console.log("want to chat",node);
        $scope.xmpp.openchat($scope.xmpp.parseNodeString(node).jid);
    }
    $scope.changenode=function(node){
            console.log("nodechange");
        console.log(arguments,node);
        $scope.node=node;
        $location.hash(node);
    }
    $scope.initbuddycloud=function(bc){
        console.log("================",bc,"==========");
        $scope.buddycloud=bc;
    }
    $scope.initxmpp=function(xmpp){
        $scope.xmpp=xmpp;
        console.log(xmpp);
        $scope.xmpp.setPresence();
    }
    $scope.showxmpp=function(){
        console.log("xmpp",$scope.xmpp,$scope.buddycloud);
    }
    $scope.initchat=function(chat){
        console.log("<<<<<<<<<<<<<<<<<<<<<<",chat);
        $scope.chat=chat;
    }
    
    $rootScope.$on('$locationChangeSuccess', function (data) {
        console.log(arguments,$location.hash());
        $scope.changenode($location.hash());
    });
}
</script>


</head>
<body ng-controller="page">
<div ng-include="'assets/partials/navbar.html'"></div>

<div style="margin-top:100px">
<h4 ng-click="hidestreams=!hidestreams"><span ng-if="hidestreams" class="closed">▸ </span><span  ng-if="!hidestreams" class="open">▼ </span>Streams</h4>
<div ng-if="!hidestreams">
<div ng-repeat="node in buddycloud.data.nodes" ng-click="changenode(node.node)" class="menu" ng-class="{'selected':selectednode.node==node.node}" >
<img ng-src="assets/icons/avatars/{{node.name}}.png" style="height:25px"/>
{{node.name}} <span ng-show="buddycloud.data.unread[node.node]" class="badge">{{buddycloud.data.unread[node.node]}}</span>
<button class="btn btn-xs btn-link  pull-right" ng-click="xmpp.openchat(node.jid)" style="position:relative">
<span class="glyphicon glyphicon-envelope " aria-hidden="true" ></span>
<span ng-show="chat.notifications.unread[node.jid]" class="label label-success label-as-badge" style="position:absolute;top:-2px;left:12px;font-size:9px;backgroung-color:yellow">{{chat.notifications.unread[node.jid]}}</span>
</button>
</div>
</div>
</div>


<div style="position:absolute;right:00px;left:200px;top:80px;">
<div style="position:relative">
<xmpp host="https://laos.buddycloud.com" oninit="initxmpp(xmpp)">
<xmpplogin></xmpplogin>
<xmppminichat oninit="initchat(scope)"></xmppminichat>
<div style="margin-right:300px;">
<buddycloud node="{{node}}" jid="jid" changenode="changenode(node,bc)" oninit="initbuddycloud(scope)"></buddycloud>

</div>
</xmpp>
</div>
</div>

</div>

</body>

</html>
